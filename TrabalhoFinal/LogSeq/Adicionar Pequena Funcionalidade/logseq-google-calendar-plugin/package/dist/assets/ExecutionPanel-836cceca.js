import{j as r,a as t,r as u,_ as y}from"./index-3d77c527.js";const P=({time:d,title:c,done:g=!1})=>r("div",{className:"flex items-start gap-3 p-3 bg-slate-50 dark:bg-slate-800 rounded-md",children:[t("label",{className:"flex items-center gap-2",children:t("input",{type:"checkbox",defaultChecked:g,className:"h-4 w-4"})}),t("div",{className:"flex-1",children:r("div",{className:"font-medium text-sm",children:[d," ‚Äî ",c]})})]}),R=({events:d=[]})=>r("div",{className:"grid grid-cols-1 gap-2",children:[t("h3",{className:"text-sm font-medium",children:"Eventos sincronizados"}),d.length===0?t("div",{className:"text-xs text-slate-500",children:"Nenhum calend√°rio ou evento sincronizado."}):t("div",{className:"space-y-2 max-h-48 overflow-auto pr-2",children:d.map(c=>r("div",{className:"p-2 rounded border border-slate-100 dark:border-slate-800",children:[t("div",{className:"text-sm font-medium",children:c.title}),t("div",{className:"text-xs text-slate-500",children:c.start})]},c.id||c.title))})]}),$=()=>{const[d,c]=u.useState([]),[g,v]=u.useState(!1),[b,m]=u.useState("disconnected"),[A,k]=u.useState([]),[S,N]=u.useState(!1),[E,_]=u.useState(""),[T,C]=u.useState(!1);u.useEffect(()=>{let e=!0;(async()=>{try{const s=await(await y(()=>import("./googleAuth-1192cdea.js"),[],import.meta.url)).getAccessToken();e&&v(!!s)}catch{e&&v(!1)}})();function o(n){try{const s=n,i=s.detail&&s.detail.status||"";if(i==="awaiting_manual_code"&&N(!0),i==="awaiting_code"&&m("awaiting_code"),i==="exchanging"&&m("exchanging"),i==="connected"&&m("connected"),i==="error"&&(m("error"),s.detail&&s.detail.message))try{window.alert("Erro na autentica√ß√£o: "+String(s.detail.message))}catch{}}catch{}}return window.addEventListener("gcal:status",o),()=>{e=!1}},[]);async function I(){try{m("awaiting_code");const e=await y(()=>import("./googleAuth-1192cdea.js"),[],import.meta.url);await e.startGoogleAuth(),m("connected");const o=await e.getAccessToken();v(!!o),o&&(window.alert("Autentica√ß√£o conclu√≠da com sucesso"),D())}catch(e){m("error"),console.error("Auth error",e);let o=String(e);e&&typeof e=="object"&&"message"in e&&(o=e.message),window.alert("Falha na autentica√ß√£o: "+o)}}async function D(){C(!0);function e(n){return/^\d{4}-\d{2}-\d{2}$/.test(n)}function o(n){if(!n)return!1;const s=new Date,i=s.getFullYear(),h=s.getMonth()+1,f=s.getDate();if(e(n)){const[a,p,l]=n.split("-").map(w=>parseInt(w,10));return a===i&&p===h&&l===f}const x=new Date(n);return Number.isNaN(x.getTime())?!1:x.getFullYear()===i&&x.getMonth()+1===h&&x.getDate()===f}try{const{listEvents:n}=await y(()=>import("./googleApi-816e721c.js"),["./googleApi-816e721c.js","./index-3d77c527.js","./index-8f60cd85.css"],import.meta.url),s=await n("primary");try{console.debug("[gcal] fetched items count:",s.length),console.debug("[gcal] sample items:",s.slice(0,8)),console.debug("[gcal] local now:",new Date().toString())}catch{}const i=s.filter(a=>o(a.start));try{console.debug("[gcal] itemsToday count:",i.length),console.debug("[gcal] itemsToday sample:",i.slice(0,8))}catch{}const h=new Map;for(const a of i){const p=a.recurringEventId||a.id||a.title||`${a.title}:${a.start}`,l=h.get(p)||[];l.push(a),h.set(p,l)}const f=[];for(const a of h.values()){const p=a.slice().sort((l,w)=>{const F=l.start?e(l.start)?new Date(l.start+"T00:00:00").getTime():new Date(l.start).getTime():1/0,O=w.start?e(w.start)?new Date(w.start+"T00:00:00").getTime():new Date(w.start).getTime():1/0;return F-O});f.push(p[0])}k(f.map(a=>({id:a.id,title:a.title,start:a.start})));const x=f.map(a=>({time:a.start||"",title:a.title,done:!1}));c(x)}catch(n){console.error("Failed to list events",n),window.alert("Falha ao listar eventos: "+String(n))}finally{C(!1)}}async function M(){try{await(await y(()=>import("./googleAuth-1192cdea.js"),[],import.meta.url)).clearToken(),v(!1),m("disconnected"),k([]),c([]),window.alert("Desconectado")}catch(e){console.error("Failed to clear token",e),window.alert("Erro ao desconectar: "+String(e))}}async function j(){try{const o=(await y(()=>import("./googleAuth-1192cdea.js"),[],import.meta.url)).provideAuthCode(E.trim());N(!1),_(""),o?window.alert("C√≥digo enviado. Aguardando conclus√£o..."):window.alert("Nenhuma opera√ß√£o aguardando c√≥digo. Tente novamente ou feche e reabra o fluxo de autentica√ß√£o.")}catch(e){console.error("Failed to provide manual code",e),window.alert("Erro ao enviar c√≥digo: "+String(e))}}const L=()=>S?t("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center",children:r("div",{className:"bg-white dark:bg-slate-900 p-4 rounded shadow max-w-lg w-full",children:[t("h4",{className:"font-semibold mb-2",children:"Colar c√≥digo de autoriza√ß√£o"}),t("textarea",{value:E,onChange:e=>_(e.target.value),className:"w-full p-2 h-24 rounded border text-black"}),r("div",{className:"mt-3 flex justify-end gap-2",children:[t("button",{onClick:()=>{N(!1),_("")},className:"px-3 py-1",children:"Cancelar"}),t("button",{onClick:j,className:"px-3 py-1 bg-sky-600 text-white rounded",children:"Enviar c√≥digo"})]})]})}):null;return r("div",{className:"max-w-md w-full bg-white/95 dark:bg-slate-900/95 shadow-lg rounded-xl p-4 font-sans text-slate-900 dark:text-slate-100",children:[t("div",{className:"flex items-center justify-between mb-3",children:t("h2",{className:"text-lg font-semibold flex items-center gap-2",children:"üìÜ Execu√ß√£o do Dia"})}),t("div",{className:"space-y-3",children:d.map((e,o)=>t(P,{time:e.time,title:e.title,done:e.done},o))}),r("div",{className:"mt-4 border-t pt-3",children:[r("div",{className:"flex items-center justify-between",children:[t("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Calend√°rios sincronizados"}),t("div",{className:"flex gap-2",children:g?t("button",{onClick:D,disabled:T,className:"px-3 py-1 rounded-md bg-sky-600 text-white text-sm",children:T?"Atualizando...":"Atualizar"}):null})]}),t("div",{className:"mt-3",children:t(R,{events:A})})]}),r("div",{className:"mt-4 flex gap-2 items-center",children:[g?null:t("button",{onClick:I,className:"flex-1 py-2 rounded-md text-white bg-sky-600 hover:bg-sky-700",children:"Conectar Google"}),t("button",{onClick:M,className:"py-2 px-3 rounded-md border border-slate-200 dark:border-slate-700",children:"Desconectar"}),t("style",{children:`.ml-2.text-sm { display: ${b==="connected"||b==="disconnected"?"none":"inline-flex"} }`}),t("div",{className:"ml-2 text-sm",children:t(z,{status:b})})]}),L()]})};function z({status:d}){const g={disconnected:{text:"Desconectado",className:"bg-gray-200 text-slate-700"},awaiting_code:{text:"Aguardando c√≥digo",className:"bg-yellow-100 text-yellow-800"},exchanging:{text:"Trocando c√≥digo...",className:"bg-sky-100 text-sky-800"},connected:{text:"Conectado",className:"bg-emerald-100 text-emerald-800"},error:{text:"Erro",className:"bg-red-100 text-red-800"}}[d];return t("div",{className:`px-2 py-1 rounded text-xs font-medium ${g.className}`,children:g.text})}export{$ as default};
